{"version":3,"file":"utils.js","sources":["../../../preview-url-secret/dist/constants.js","../../src/utils.ts"],"sourcesContent":["const schemaType = \"sanity.previewUrlSecret\", schemaIdPrefix = \"sanity-preview-url-secret\", schemaIdSingleton = `${schemaIdPrefix}.share-access`, schemaTypeSingleton = \"sanity.previewUrlShareAccess\", apiVersion = \"2025-02-19\", urlSearchParamPreviewSecret = \"sanity-preview-secret\", urlSearchParamPreviewPathname = \"sanity-preview-pathname\", urlSearchParamPreviewPerspective = \"sanity-preview-perspective\", urlSearchParamVercelProtectionBypass = \"x-vercel-protection-bypass\", urlSearchParamVercelSetBypassCookie = \"x-vercel-set-bypass-cookie\", isDev = process.env.NODE_ENV === \"development\", SECRET_TTL = 3600, fetchSecretQuery = (\n  /* groq */\n  `*[_type == \"${schemaType}\" && secret == $secret && dateTime(_updatedAt) > dateTime(now()) - ${SECRET_TTL}][0]{\n    _id,\n    _updatedAt,\n    secret,\n    studioUrl,\n  }`\n), fetchSharedAccessQuery = (\n  /* groq */\n  `*[_id == \"${schemaIdSingleton}\" && _type == \"${schemaTypeSingleton}\"][0].secret`\n), fetchSharedAccessSecretQuery = (\n  /* groq */\n  `*[_id == \"${schemaIdSingleton}\" && _type == \"${schemaTypeSingleton}\" && secret == $secret][0]{\n  secret,\n  studioUrl,\n}`\n), deleteExpiredSecretsQuery = (\n  /* groq */\n  `*[_type == \"${schemaType}\" && dateTime(_updatedAt) <= dateTime(now()) - ${SECRET_TTL}]`\n), vercelProtectionBypassSchemaType = \"sanity.vercelProtectionBypass\", vercelProtectionBypassSchemaId = `${schemaIdPrefix}.vercel-protection-bypass`, fetchVercelProtectionBypassSecret = (\n  /* groq */\n  `*[_id == \"${vercelProtectionBypassSchemaId}\" && _type == \"${vercelProtectionBypassSchemaType}\"][0].secret`\n), tag = \"sanity.preview-url-secret\", perspectiveCookieName = \"sanity-preview-perspective\";\nexport {\n  SECRET_TTL,\n  apiVersion,\n  deleteExpiredSecretsQuery,\n  fetchSecretQuery,\n  fetchSharedAccessQuery,\n  fetchSharedAccessSecretQuery,\n  fetchVercelProtectionBypassSecret,\n  isDev,\n  perspectiveCookieName,\n  schemaIdPrefix,\n  schemaIdSingleton,\n  schemaType,\n  schemaTypeSingleton,\n  tag,\n  urlSearchParamPreviewPathname,\n  urlSearchParamPreviewPerspective,\n  urlSearchParamPreviewSecret,\n  urlSearchParamVercelProtectionBypass,\n  urlSearchParamVercelSetBypassCookie,\n  vercelProtectionBypassSchemaId,\n  vercelProtectionBypassSchemaType\n};\n//# sourceMappingURL=constants.js.map\n","import {validateApiPerspective, type ClientPerspective} from '@sanity/client'\n\n/** @internal */\nexport function sanitizePerspective(\n  _perspective: unknown,\n  fallback: 'drafts' | 'published',\n): Exclude<ClientPerspective, 'raw'> {\n  const perspective =\n    typeof _perspective === 'string' && _perspective.includes(',')\n      ? _perspective.split(',')\n      : _perspective\n  try {\n    validateApiPerspective(perspective)\n    return perspective === 'raw' ? fallback : perspective\n  } catch (err) {\n    // eslint-disable-next-line no-console\n    console.warn(`Invalid perspective:`, _perspective, perspective, err)\n    return fallback\n  }\n}\n"],"names":[],"mappings":";AAAA,MAuBsC,wBAAwB;ACpBvD,SAAS,oBACd,cACA,UACmC;AACnC,QAAM,cACJ,OAAO,gBAAiB,YAAY,aAAa,SAAS,GAAG,IACzD,aAAa,MAAM,GAAG,IACtB;AACN,MAAI;AACF,WAAA,uBAAuB,WAAW,GAC3B,gBAAgB,QAAQ,WAAW;AAAA,EAC5C,SAAS,KAAK;AAEZ,WAAA,QAAQ,KAAK,wBAAwB,cAAc,aAAa,GAAG,GAC5D;AAAA,EACT;AACF;"}